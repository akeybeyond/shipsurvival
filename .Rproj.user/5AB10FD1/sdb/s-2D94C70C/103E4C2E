{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Exploring the Titanic\"\noutput: github_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\nknitr::opts_chunk$set(error = TRUE)\n```\n\n```{r}\n#Importing setting to flag strings and not have R automatically label char as factors.\ndf.train <- read.csv(\"train.csv\",\n                     stringsAsFactors = FALSE,\n                      na.strings=c(\"NA\",\"\") \n                      )\n\ndf.test <- read.csv(\"test.csv\",\n                    stringsAsFactors = FALSE,\n                    na.strings=c(\"NA\",\"\")\n                    )\n\n#Creating a place holder column in our df\ndf.test$Survived = 0 \n\n#combine df\ndf.full  <- rbind(df.train, df.test) \n\n#Summary\nstr(df.full)\n\n#Missing data\nsapply(df.full, function(df){\n    sum(is.na(df==TRUE) /length(df));\n    })\n\n#Visualize training data\nhist(df.train$Age, \n     main = \"Age\",\n     xlab = \"Age\",\n     col=\"#1B9E77\"\n     )\n\nbarplot(table(df.train$Survived),\n        main=\"Survived\",\n        names.arg = c(\"No\",\n                      \"Yes\"\n                      ),\n        col=\"#1B9E77\"\n        )\n\nbarplot(table(df.train$Sex),\n        main = \"Sex\",\n        names.arg = c(\"Male\",\n                      \"Female\"\n                      ),\n        col=c(\"#1B9E77\",\n              \"#D95F02\"\n              )\n        )\nbarplot(table(df.train$Embarked),\n        main = \"Embarked\",\n        names.arg =c( \"Cherbourg\",\n                      \"Queenstown\",\n                      \"Southampton\"\n                    ),\n        col=c(\"#1B9E77\",\n              \"#D95F02\",\n              \"#7570B3\"\n              )\n        )\nbarplot(table(df.train$Pclass),\n        main = \"Passenger Class\",\n        col= c(\"#1B9E77\",\n               \"#D95F02\",\n               \"#7570B3\"\n               )\n        )\n\nbarplot(table(df.train$Parch),\n        main = \"Parchren and Parents Aboard\",\n        col=c(\"#1B9E77\",\n              \"#D95F02\",\n              \"#7570B3\",\n              \"#E7298A\",\n              \"#66A61E\",\n              \"#E6AB02\"\n              )\n        )\n        \nbarplot(table(df.train$SibSp),\n        main = \"Siblings and Spouse Aboard\",\n        col=c(\"#1B9E77\",\n              \"#D95F02\",\n              \"#7570B3\",\n              \"#E7298A\",\n              \"#66A61E\",\n              \"#E6AB02\",\n              \"#A6761D\",\n              \"#666666\"\n              )\n        )\n\n#Post Processing\n\n#Embarked\ndf.full$Embarked <- as.factor(df.full$Embarked)\nsummary(df.full$Embarked)\ndf.full$Embarked[which(is.na(df.full$Embarked))] = 'S'\n\n#Age\nsummary(df.full$Age)\n\ndf.full$Title <- gsub('(.*, )|(\\\\..*)', '', df.full$Name)\n\ntable(df.full$Sex, df.full$Title)\nmean.age <- mean(df.full$Age[df.full$Title])\n\naggregate(df.full$Age,list(df.full$Title),mean)\n\ndf.full$Title[df.full$Title == 'Mlle'] <- 'Miss' \ndf.full$Title[df.full$Title == 'Ms'] <- 'Miss'\ndf.full$Title[df.full$Title == 'Mme'] <- 'Mrs' \ndf.full$Title[df.full$Title == 'Dona'] <- 'Mrs' \ndf.full$Title[df.full$Title == 'the Countess'] <- 'Mrs'\ndf.full$Title[df.full$Title == 'Lady'] <- 'Mrs'\ndf.full$Title[df.full$Title == 'Dr' & df.full$Sex == 'female'] <- 'Mrs'\ndf.full$Title[df.full$Title == 'Jonkheer'] <- 'Mr' \ndf.full$Title[df.full$Title == 'Don'] <- 'Mr' \ndf.full$Title[df.full$Title == 'Col'] <- 'Mr' \ndf.full$Title[df.full$Title == 'Capt'] <- 'Mr' \ndf.full$Title[df.full$Title == 'Major'] <- 'Mr' \ndf.full$Title[df.full$Title == 'Rev'] <- 'Mr' \ndf.full$Title[df.full$Title == 'Sir'] <- 'Mr' \ndf.full$Title[df.full$Title == 'Dr' & df.full$Sex == 'male'] <- 'Mr' \n\ntable(df.full$Sex, df.full$Title)\n\nmean.miss = mean(\n                df.full$Age[\n                            df.full$Title == 'Miss' & !is.na(df.full$Age)\n                            ]\n                )\n\nmean.mrs = mean(\n                df.full$Age[\n                            df.full$Title == 'Mrs' & !is.na(df.full$Age)\n                            ]\n                )\n\n\nmean.master = mean(\n                df.full$Age[\n                            df.full$Title == 'Master' & !is.na(df.full$Age)\n                            ]\n                )\n\n\nmean.mr = mean(\n                df.full$Age[\n                            df.full$Title == 'Mr' & !is.na(df.full$Age)\n                            ]\n                )\n\ndf.full$Age[df.full$Title =='Miss' & is.na(df.full$Age)] <- mean.miss\ndf.full$Age[df.full$Title =='Mrs' & is.na(df.full$Age)] <- mean.mrs\ndf.full$Age[df.full$Title =='Master' & is.na(df.full$Age)] <- mean.master\ndf.full$Age[df.full$Title =='Mr' & is.na(df.full$Age)] <- mean.mr\n\n\n\nFare\nsummary(df.full$Fare)\n\n\ndf.full$FareCat [df.full$Fare < 10 | df.full$Fare == 10] <- 3\ndf.full$FareCat [df.full$Fare > 10 & df.full$Fare < 20]  <- 2\ndf.full$FareCat [df.full$Fare > 30]                      <- 1\n\ntable(df.full$FareCat, df.full$Pclass)\n\n#using this we can roughly estimate our missing fare value.\n\n\nest.Fare <- mean(df.full$Fare[df.full$Pclass == df.full$Pclass[is.na(df.full$Fare)] & !is.na(df.full$Fare)])\ndf.full$Fare[is.na(df.full$Fare)] <- est.Fare\n\ndf.full$FareCat [df.full$Fare < 10 | df.full$Fare == 10] <- 3\ndf.full$FareCat [df.full$Fare > 10 & df.full$Fare < 20]  <- 2\ndf.full$FareCat [df.full$Fare >= 20]                      <- 1\n\nsapply(df.full, function(df){\n    sum(is.na(df==TRUE) /length(df));\n    })\n\n# So now we have replaced our NA values in Age with our predictions based upon titles. Missing Embarked values were replaced using the mode, which was South Hampton the starting point of the maiden voyage. Fare was estimated using Pclass, and Cabin was left unchanged as there is too much missing data.\n\n\ndf.train <- df.full[1:891,]\ndf.test <- df.full[892:1309,]\n\nsummary(aov(Survived ~ Pclass + Parch + Age + Sex, df.train))\n\n\nglm.survived <-  glm(Survived ~ Pclass + Parch + Age + Sex, family = binomial, data = df.train)\npred.survived <- predict(\n                          object = glm.survived,\n                          newdata = df.test,\n                          type = \"response\"\n                          )\ndf.test$Survived <- as.numeric(as.numeric(pred.survived)>0.5)\nwrite.csv(df.test[,c(\"PassengerId\", \"Survived\")],\"submit.csv\", row.names=F)\n\n```\n",
    "created" : 1498541608907.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2080659440",
    "id" : "103E4C2E",
    "lastKnownWriteTime" : 1498587178,
    "last_content_update" : 1498587178063,
    "path" : "C:/Users/E V D S/OneDrive/Main/Public/GitHub/shipsurvival/shipsurvival.Rmd",
    "project_path" : "shipsurvival.Rmd",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}