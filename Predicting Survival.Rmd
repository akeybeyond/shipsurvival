---
title: "Titanic R"
author: "A Key Beyond""
date: "June 24, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Setting Sail



Who doesn't wish they could be held oh so lovinginly by a charming character with the boyish looks of a young Leonardo while being serenaded by the ever so talented 
<a href="https://www.youtube.com/watch?v=DNyKDI9pn0Q
" target="_blank">Celine Dion </a>. So, allow us to begin this grand adventure and break the proverbial  bottle of bubbly as we set sail. 

```{r}
df.train <- read.csv("train.csv",
                      na.strings=c("NA","") 
                      )

df.test <- read.csv("test.csv")
```

Looking through the dataset quickly it's apparent that the data is dillimenated by commas, as such `read.csv` is appropriate. We will use the augmentation `na.strings =c("NA", "")` to ensure that missing data will be appropiately flagged. Next let's check our data quickly to ensure nothing is out of place.

```{r}
str(df.train)
df.train$Survived = as.factor(df.train$Survived)
```
Looking at the short summary we can look at the classes for the data we imported. There does not seem to be anything out of the ordinary here so we will not need to make any adjustments.

```{r}
sapply(df.train, function(df){
    sum(is.na(df==TRUE) /length(df));
    })
```
Next want to look to see if any data is missing, rather than looking through manually we can quickly get a summary by using the above function which gives us the percentage of missing data in a given variable. In the case of Cabin there is a significant amount of data missing, meaning it's unlikely we would want to try to estimate the missing values. On the other hand embarked is missing 0.002% of data values so we would likely not be too worried about this. Age is in between these two extremes missing roughly 20% of the data values. Because our data-set is fairly small we cannot be too confident in estimating the missing values. However since we are given the titles of each passenger we might be able to use titles to predict the age reasonably well.


```{r}

hist(df.train$Age, 
     main = "Age",
     xlab = "Age",
     col="#1B9E77"
     )

barplot(table(df.train$Survived),
        main="Survived",
        names.arg = c("No","Yes"),
        col="#1B9E77"
        )

barplot(table(df.train$Sex),
        main = "Sex",
        names.arg = c("Male","Female"),
        col="#1B9E77"
        )
barplot(table(df.train$Embarked),
        main = "Embarked",
        names.arg = c("Cherbourg","Queenstown","Southampton"),
        col="#1B9E77"
        )
barplot(table(df.train$Pclass),
        main = "Passenger Class",
        col="#1B9E77"
        )

barplot(table(df.train$Parch),
        main = "Parchren and Parents Aboard",
        col="#1B9E77"
        )
        
barplot(table(df.train$SibSp),
        main = "Siblings and Spouse Aboard",
        col="#1B9E77"
        )
```



### Magic Black Box

Let's first start with Embarked, as it's likely that we can reasonably assume that our for our passengers with missing data embarked from South Hampton or `S`. 

```{r}
table(df.train$Embarked, useNA = "ifany")
```
Seeing how we only have 2 missing values, we can assume that they embarked from South Hampton. We will use `which(is.na())` to ensure that all values in the `na` data values in the data set are replaced with S.

```{r}
df.train$Embarked[which(is.na(df.train$Embarked))] = 'S'
```

```{r}
df.train$Title = as.character(df.train$Name)
```

Next let's work on age. With age even though there is a large amount of data missing we can potentialy make use of the names (which include titles) to make reasonable predictions for the emissing values. 

```{r}

tb.titles = table(unlist(strsplit(df.train$Title, "\\s")))
sort(tb.titles [grep('\\.',names(tb.titles))])
```
Looking at titles we have a few ones that are unique but can be reasonable grouped into one of the four major categories (Master, Mrs, Miss and Mr). For the other titles we will combine them as appropiate. 

```{r}
df.train$Title[which(grepl(" Capt\\.", df.train$Title))] = 'Mr.' 
df.train$Title[which(grepl(" Countess\\.", df.train$Title))] = 'Mrs.'
df.train$Title[which(grepl(" Don\\.", df.train$Title))] = 'Mr.'
df.train$Title[which(grepl(" L\\.", df.train$Title))] = 'Mr.'
df.train$Title[which(grepl(" Jonkheer\\.", df.train$Title))] = 'Mr.'
df.train$Title[which(grepl(" Lady\\.", df.train$Title))] = 'Mrs.'
df.train$Title[which(grepl(" Mme\\.", df.train$Title))] = 'Miss.'
df.train$Title[which(grepl(" Ms\\.", df.train$Title))] = 'Miss.'
df.train$Title[which(grepl(" Sir\\.", df.train$Title))] = 'Mr.'
df.train$Title[which(grepl(" Col\\.", df.train$Title))] = 'Mr.'
df.train$Title[which(grepl(" Major\\.", df.train$Title))] = 'Mr.'
df.train$Title[which(grepl(" Mlle\\.", df.train$Title))] = 'Miss.'
df.train$Title[which(grepl(" Rev\\.", df.train$Title))] = 'Mr.'
df.train$Title[which(grepl(" Dr\\.", df.train$Title))] = 'Mr.'

```

After recoding out variables we will now estimate the means for each of our four major categories. Then add estimates for age based upon title in place of the missing variables. 

```{r}
#Calculating the mean for each grouping. 

mean.mr = mean(df.train$Age[grepl(" Mr\\.", df.train$Title) & !is.na(df.train$Age)])

mean.mstr = mean(df.train$Age[grepl(" Master\\.", df.train$Title) & !is.na(df.train$Age)])

mean.mrs = mean(df.train$Age[grepl(" Mrs\\.", df.train$Title) & !is.na(df.train$Age)])

mean.miss = mean(df.train$Age[grepl(" Miss\\.", df.train$Title) & !is.na(df.train$Age)])

df.train$Age[grepl(" Mr\\.", df.train$Title) & is.na(df.train$Age)] = mean.mr
df.train$Age[grepl(" Master\\.", df.train$Title) & is.na(df.train$Age)] = mean.mstr
df.train$Age[grepl(" Mrs\\.", df.train$Title) & is.na(df.train$Age)] = mean.mrs
df.train$Age[grepl(" Miss\\.", df.train$Title) & is.na(df.train$Age)] = mean.miss
df.train$Age[grepl(" Mr.\\.", df.train$Title) & is.na(df.train$Age)] = mean.mr
```

Finally while Cabin might be useful in our model there is simply too much unknown information to reasonably estimate it or include it in a model. While it's possible we could estimate based upon factors like fare because it is so incomplete it would be heavily flawed.

```{r}
sapply(df.train, function(df){
    sum(is.na(df==TRUE) /length(df));
    })
```
Checking our variables again, there are still missing values in age. We will want to double check how the data was input for the cases that are still missing data. However for simplisity I will just replace these remaining NA values with the overall mean age.

```{r}

```



### Striking that Pose

Realistically this isn't the point of doing this work but we might as well throw our hat in the ring right?


```{r}
plot(as.factor(df.train$Pclass),df.train$Survived,
     col=c("#39BEB1","#E495A5"),
     main = "Passenger Class vs Survival",
     ylab = "Survived",
     xlab = "Passenger Class"
     );
axis(2, at = c(0.2,0.7), labels = c("Survived", "Perished") )


```


```{r}
fit <- glm(Survived ~ Pclass + Sex + Age + SibSp + Parch + Sex * Pclass, 
    family = binomial, data = df.train)
#Predict values based on linear model object (fit).
Prediction <-  predict(fit,df.test,type ="response")
submit <- data.frame(PassengerId = df.test$PassengerId, Survived = Prediction)
write.csv(submit, file = "submit.csv", row.names = FALSE)

fit.5 <- glm(Survived ~ Pclass+Age+SibSp+Parch, data=df.train, family=binomial(("logit")))
predict.5<-predict(fit.5,  newdata=df.test, type="response")
df.test$Survived <- as.numeric(as.numeric(predict.5)>0.5)
write.csv(df.test[,c("PassengerId", "Survived")],"submit.csv", row.names=F)

```



